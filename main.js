/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var x=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var H=(d,p)=>{for(var t in p)x(d,t,{get:p[t],enumerable:!0})},_=(d,p,t,e)=>{if(p&&typeof p=="object"||typeof p=="function")for(let i of V(p))!A.call(d,i)&&i!==t&&x(d,i,{get:()=>p[i],enumerable:!(e=R(p,i))||e.enumerable});return d};var F=d=>_(x({},"__esModule",{value:!0}),d);var z={};H(z,{default:()=>v});module.exports=F(z);var P=require("obsidian");var L=require("obsidian");var k="related-notes-view",O={tagLimit:3,tagLinkLimit:5,perTagLinkLimit:5,outgoingLinkLimit:5,backlinkLimit:5,randomizeOrder:!1,fontSize:"14px",lineHeight:"1.6",hiddenNotePaths:[],showTagHierarchy:!0,showDividers:!0,headingStyle:"default",allowTagOverlapOutsideHierarchy:!1};var y=class extends L.ItemView{constructor(t,e,i){super(t);this.app=e,this.settings=i}getViewType(){return k}getDisplayText(){return"Related Notes"}async onOpen(){this.registerEvent(this.app.workspace.on("file-open",()=>this.renderView())),this.renderView()}async renderView(){var a;let t=this.containerEl.children[1];t.empty(),t.setAttr("style",`font-size: ${this.settings.fontSize}; line-height: ${this.settings.lineHeight};`);let e=this.app.workspace.getActiveFile();if(!e){t.createEl("p",{text:"No active file."});return}let i=this.app.metadataCache.getFileCache(e),l=i?(a=(0,L.getAllTags)(i))!=null?a:[]:[];if(this.settings.showTagHierarchy){let o=new Set;for(let n of l){let r=n.split("/"),u=[];for(let T of r)u.push(T),o.add(u.join("/"))}l=Array.from(o),l.sort((n,r)=>r.split("/").length-n.split("/").length);let g=new Set;l=l.filter(n=>{if(this.settings.allowTagOverlapOutsideHierarchy)return!0;let r=[...g].some(u=>n.startsWith(u+"/"));return r||g.add(n),!r})}let h=l.slice(0,this.settings.tagLimit),s=this.app.vault.getMarkdownFiles();this.renderCollapsibleSection(t,"\u{1F3F7} \u30BF\u30B0\u304B\u3089\u306E\u95A2\u9023",o=>this.renderTagsSection(o,h,e,s)),this.settings.showDividers&&t.createEl("hr",{cls:"related-divider"}),this.renderCollapsibleSection(t,"\u2192 \u30A2\u30A6\u30C8\u30B4\u30FC\u30A4\u30F3\u30B0\u30EA\u30F3\u30AF",o=>{var g;return this.renderOutgoingLinks(o,(g=i==null?void 0:i.links)!=null?g:[],s)}),this.settings.showDividers&&t.createEl("hr",{cls:"related-divider"}),this.renderCollapsibleSection(t,"\u2190 \u30D0\u30C3\u30AF\u30EA\u30F3\u30AF",o=>this.renderBacklinks(o,e,s))}renderCollapsibleSection(t,e,i){let l=t.createEl("details",{cls:"related-section"});l.setAttr("open","");let h=e.replace(/→|←|🏷/g,"").trim();l.createEl("summary",{text:this.settings.headingStyle==="minimal"?h:e}),i(l)}renderTagsSection(t,e,i,l){let h={};for(let a of e){let o=a.split("/"),g=h;for(let n of o)g[n]||(g[n]={__children:{}}),g=g[n].__children}let s=(a,o,g,n=0)=>{for(let r in a){let u=o?`${o}/${r}`:r,T=g.createEl("details",{cls:"tag-section"});T.style.marginLeft=`${n*.5}rem`,T.setAttr("open",""),T.createEl("summary",{text:`#${u}`});let C=l.filter(f=>{var S;if(f.path===i.path||this.settings.hiddenNotePaths.includes(f.path))return!1;let m=this.app.metadataCache.getFileCache(f);return(m?(S=(0,L.getAllTags)(m))!=null?S:[]:[]).includes(u)}),b=(this.settings.randomizeOrder?C.sort(()=>Math.random()-.5):C.sort((f,m)=>m.stat.mtime-f.stat.mtime)).slice(0,this.settings.perTagLinkLimit);if(b.length>0){let f=T.createEl("ul");f.style.listStyle="none",b.forEach((m,D)=>{let S=D%2===0?"even-item":"odd-item",w=f.createEl("li",{cls:S}).createEl("a",{text:m.basename,href:m.path});w.setAttr("data-href",m.path),w.addClass("internal-link"),w.onclick=E=>{E.preventDefault(),this.app.workspace.openLinkText(m.path,m.path)},w.oncontextmenu=E=>{E.preventDefault(),this.app.workspace.trigger("link-contextmenu",E,w)}})}s(a[r].__children,u,T,n+1)}};s(h,"",t)}renderOutgoingLinks(t,e,i){let l=t.createEl("ul"),h=e.map(s=>i.find(a=>s.link&&s.link.startsWith(a.basename))).filter(s=>!!s&&!this.settings.hiddenNotePaths.includes(s.path));h=this.settings.randomizeOrder?h.sort(()=>Math.random()-.5):h.sort((s,a)=>a.stat.mtime-s.stat.mtime),h.slice(0,this.settings.outgoingLinkLimit).forEach((s,a)=>{let o=a%2===0?"even-item":"odd-item",n=l.createEl("li",{cls:o}).createEl("a",{text:s.basename,href:s.path});n.setAttr("data-href",s.path),n.addClass("internal-link"),n.onclick=r=>{r.preventDefault(),this.app.workspace.openLinkText(s.path,s.path)},n.oncontextmenu=r=>{r.preventDefault(),this.app.workspace.trigger("link-contextmenu",r,n)}})}renderBacklinks(t,e,i){let l=t.createEl("ul"),h=i.filter(s=>{var g;if(s.path===e.path||this.settings.hiddenNotePaths.includes(s.path))return!1;let a=this.app.metadataCache.getFileCache(s);return((g=a==null?void 0:a.links)!=null?g:[]).some(n=>n.link&&n.link.startsWith(e.basename))});h=this.settings.randomizeOrder?h.sort(()=>Math.random()-.5):h.sort((s,a)=>a.stat.mtime-s.stat.mtime),h.slice(0,this.settings.backlinkLimit).forEach((s,a)=>{let o=a%2===0?"even-item":"odd-item",n=l.createEl("li",{cls:o}).createEl("a",{text:s.basename,href:s.path});n.setAttr("data-href",s.path),n.addClass("internal-link"),n.onclick=r=>{r.preventDefault(),this.app.workspace.openLinkText(s.path,s.path)},n.oncontextmenu=r=>{r.preventDefault(),this.app.workspace.trigger("link-contextmenu",r,n)}})}async onClose(){}};var c=require("obsidian"),N=class extends c.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Related Notes Settings"}),new c.Setting(t).setName("\u30BF\u30B0\u8868\u793A\u4E0A\u9650").setDesc("\u8868\u793A\u3059\u308B\u30BF\u30B0\u30AB\u30C6\u30B4\u30EA\u6570\u306E\u6700\u5927\u5024").addText(e=>e.setPlaceholder("\u4F8B: 3").setValue(this.plugin.settings.tagLimit.toString()).onChange(async i=>{this.plugin.settings.tagLimit=parseInt(i)||0,await this.plugin.saveSettings()})),new c.Setting(t).setName("\u30BF\u30B0\u3054\u3068\u306E\u30EA\u30F3\u30AF\u4E0A\u9650").addText(e=>e.setPlaceholder("\u4F8B: 5").setValue(this.plugin.settings.tagLinkLimit.toString()).onChange(async i=>{this.plugin.settings.tagLinkLimit=parseInt(i)||0,await this.plugin.saveSettings()})),new c.Setting(t).setName("\u30A2\u30A6\u30C8\u30B4\u30FC\u30A4\u30F3\u30B0\u30EA\u30F3\u30AF\u4E0A\u9650").addText(e=>e.setPlaceholder("\u4F8B: 5").setValue(this.plugin.settings.outgoingLinkLimit.toString()).onChange(async i=>{this.plugin.settings.outgoingLinkLimit=parseInt(i)||0,await this.plugin.saveSettings()})),new c.Setting(t).setName("\u30D0\u30C3\u30AF\u30EA\u30F3\u30AF\u4E0A\u9650").addText(e=>e.setPlaceholder("\u4F8B: 5").setValue(this.plugin.settings.backlinkLimit.toString()).onChange(async i=>{this.plugin.settings.backlinkLimit=parseInt(i)||0,await this.plugin.saveSettings()})),new c.Setting(t).setName("\u30E9\u30F3\u30C0\u30E0\u8868\u793A\u9806").setDesc("\u8868\u793A\u9806\u3092\u30E9\u30F3\u30C0\u30E0\u306B\u3059\u308B").addToggle(e=>e.setValue(this.plugin.settings.randomizeOrder).onChange(async i=>{this.plugin.settings.randomizeOrder=i,await this.plugin.saveSettings()})),new c.Setting(t).setName("\u6587\u5B57\u30B5\u30A4\u30BA").setDesc("px\u5358\u4F4D\u3067\u6307\u5B9A").addText(e=>e.setPlaceholder("\u4F8B: 14px").setValue(this.plugin.settings.fontSize).onChange(async i=>{this.plugin.settings.fontSize=i,await this.plugin.saveSettings()})),new c.Setting(t).setName("\u884C\u9593").setDesc("CSS line-height \u5024 (\u4F8B: 1.6)").addText(e=>e.setPlaceholder("\u4F8B: 1.6").setValue(this.plugin.settings.lineHeight).onChange(async i=>{this.plugin.settings.lineHeight=i,await this.plugin.saveSettings()})),new c.Setting(t).setName("\u30BF\u30B0\u968E\u5C64\u306E\u8868\u793A").setDesc("true\u3067 #\u89AA/\u5B50/\u5B6B \u30BF\u30B0\u3082\u968E\u5C64\u3067\u8868\u793A").addToggle(e=>e.setValue(this.plugin.settings.showTagHierarchy).onChange(async i=>{this.plugin.settings.showTagHierarchy=i,await this.plugin.saveSettings()})),new c.Setting(t).setName("\u30BB\u30AF\u30B7\u30E7\u30F3\u3054\u3068\u306E\u533A\u5207\u308A\u7DDA").setDesc("\u898B\u3084\u3059\u304F\u3059\u308B\u305F\u3081\u306E\u8584\u3044\u7F6B\u7DDA\u3092\u8868\u793A").addToggle(e=>e.setValue(this.plugin.settings.showDividers).onChange(async i=>{this.plugin.settings.showDividers=i,await this.plugin.saveSettings()})),new c.Setting(t).setName("\u898B\u51FA\u3057\u30B9\u30BF\u30A4\u30EB").setDesc("\u53C2\u7167\u5143\u306E\u898B\u51FA\u3057\u8868\u793A\u30B9\u30BF\u30A4\u30EB").addDropdown(e=>e.addOption("default","\u30C7\u30D5\u30A9\u30EB\u30C8\uFF08\u30A2\u30A4\u30B3\u30F3\u4ED8\u304D\uFF09").addOption("minimal","\u30DF\u30CB\u30DE\u30EB\uFF08\u30B7\u30F3\u30D7\u30EB\uFF09").setValue(this.plugin.settings.headingStyle).onChange(async i=>{this.plugin.settings.headingStyle=i,await this.plugin.saveSettings()})),new c.Setting(t).setName("\u975E\u8868\u793A\u30CE\u30FC\u30C8 (1\u884C1\u30D5\u30A1\u30A4\u30EB\u306E\u30D1\u30B9)").setDesc("\u3053\u306E\u4E00\u89A7\u306B\u3042\u308B\u30CE\u30FC\u30C8\u306F\u30B5\u30A4\u30C9\u30D0\u30FC\u306B\u8868\u793A\u3055\u308C\u307E\u305B\u3093\u3002").addTextArea(e=>{e.setPlaceholder("example: folder/note.md").setValue(this.plugin.settings.hiddenNotePaths.join(`
`)).onChange(async i=>{this.plugin.settings.hiddenNotePaths=i.split(`
`).map(l=>l.trim()).filter(Boolean),await this.plugin.saveSettings()})})}};var v=class extends P.Plugin{async onload(){this.settings=Object.assign({},O,await this.loadData()),this.registerView(k,t=>new y(t,this.app,this.settings)),this.addRibbonIcon("link","Show Related Notes",async()=>{let t=this.app.workspace.getRightLeaf(!1);t&&(await t.setViewState({type:k,active:!0}),this.app.workspace.revealLeaf(t))}),this.addSettingTab(new N(this.app,this))}async saveSettings(){await this.saveData(this.settings)}onunload(){this.app.workspace.detachLeavesOfType(k)}};
